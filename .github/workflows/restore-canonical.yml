name: Restore Canonical Assets

on:
  push:
    branches:
      - main

jobs:
  restore:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Fetch canonical branch
        run: |
          git fetch origin upgrade-index

      - name: Restore missing canonical files
        run: |
          NEED_COMMIT=0

          restore () {
            FILE=$1
            if [ ! -f "$FILE" ]; then
              echo "ðŸ”„ Restoring $FILE from upgrade-index"
              git checkout origin/upgrade-index -- "$FILE" || true
              NEED_COMMIT=1
            fi
          }

          restore patch-eureka.js
          restore patch-design.js
          restore seal-eureka.js
          restore assets/images/index.jpg
          restore assets/images/1.png

          if [ "$NEED_COMMIT" -eq 1 ]; then
            git config user.name "eureka-bot"
            git config user.email "actions@github.com"
            git add .
            git commit -m "Restore canonical assets from upgrade-index"
          else
            echo "âœ” Nothing to restore"
          fi

      - name: Push restored files
        if: success()
        run: |
          git push origin main
