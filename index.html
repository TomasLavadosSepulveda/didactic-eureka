<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Didactic Eureka</title>

<style>
:root{
  --bg:#f6f5f2; --paper:#fff; --ink:#141414;
  --muted:#666; --line:#e2e0d9; --accent:#1f3cff;
}
*{box-sizing:border-box}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font-family: ui-serif, Georgia, "Times New Roman", serif;
  line-height:1.7;
}
.wrap{max-width:1200px;margin:auto;padding:0 22px}
header{
  position:sticky;top:0;z-index:10;
  background:var(--paper);border-bottom:1px solid var(--line);
}
.top{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 0;
}
h1{margin:0;font-size:22px}

/* NAV MEJORADO */
nav{
  display:flex;
  gap:6px;
  overflow-x:auto;
  white-space:nowrap;
  scrollbar-width:thin;
}
nav::-webkit-scrollbar{height:6px}
nav::-webkit-scrollbar-thumb{background:#ccc;border-radius:6px}

nav button{
  background:none;border:none;
  font-family:inherit;font-size:13px;
  padding:6px 12px;border-radius:999px;
  cursor:pointer;flex:0 0 auto;
}
nav button.active,
nav button:hover{background:#efefe9}

main{padding:26px 0 48px}

.panel{
  background:var(--paper);
  border:1px solid var(--line);
  border-radius:16px;
  padding:18px;
  margin-bottom:20px;
}
.panel h2{margin:0 0 12px;font-size:20px}

.item{
  padding:10px 0;border-top:1px solid var(--line);
}
.item:first-child{border-top:none}

.item button{
  background:none;border:none;
  font-family:inherit;font-size:15px;
  color:var(--accent);
  cursor:pointer;
}
.item button:hover{text-decoration:underline}

.thumb{
  max-width:520px;width:100%;
  border-radius:12px;border:1px solid var(--line);
  margin:10px 0;
}

.article{
  background:var(--paper);
  border:1px solid var(--line);
  border-radius:16px;
  padding:20px;
}
.article h2{margin-top:0}
.article img{
  max-width:100%;
  border-radius:12px;border:1px solid var(--line);
  margin-bottom:14px;
}
iframe{
  width:100%;height:75vh;
  border:none;border-radius:12px;
}

footer{
  border-top:1px solid var(--line);
  padding:18px 0;
  text-align:center;font-size:12px;color:var(--muted);
}
</style>
</head>

<body>

<header>
  <div class="wrap top">
    <h1>Didactic Eureka</h1>
    <nav id="tabs"></nav>
  </div>
</header>

<main class="wrap" id="content">
  <p>Cargando estructura…</p>
</main>

<footer>
  Didactic Eureka · interfaz bifásica · auto-lectura real
</footer>

<script>
const owner = location.hostname.split(".")[0];
const repo  = location.pathname.split("/").filter(Boolean)[0];
const API   = `https://api.github.com/repos/${owner}/${repo}/contents`;
const IMG_RE = /\.(jpg|jpeg|png|webp)$/i;

/* ===== HUMANIZACIÓN DE TÍTULOS ===== */
const DICT = [
  "conciencia","hylotraxica","final","teoria","metodo","filosofia",
  "teologia","ciencia","antropologia","psicologia","lenguaje","epica",
  "critica","analisis","introduccion","fundamentos","ensayo","modelo"
];

function smartTitle(str){
  let s = str.replace(/\.pdf$/i,"");
  s = s.replace(/[_\-]+/g," ");
  s = s.replace(/([a-z])([A-Z])/g,"$1 $2");
  if(!s.includes(" ")){
    for(const w of DICT){
      s = s.replace(new RegExp(w,"gi")," "+w+" ");
    }
  }
  return s
    .replace(/\s+/g," ")
    .trim()
    .toLowerCase()
    .split(" ")
    .map(w=>w[0]?w[0].toUpperCase()+w.slice(1):"")
    .join(" ");
}

async function fetchDir(path=""){
  const r = await fetch(path?`${API}/${encodeURIComponent(path)}`:API);
  if(!r.ok) return [];
  return await r.json();
}

function renderArticle(pdf, img){
  const c = document.getElementById("content");
  c.innerHTML = `
    <div class="article">
      <h2>${smartTitle(pdf.name)}</h2>
      ${img?`<img src="${img.download_url}">`:``}
      <iframe src="${pdf.download_url}#toolbar=0&navpanes=0&view=FitH"></iframe>
    </div>
  `;
  window.scrollTo({top:0,behavior:"smooth"});
}

async function renderCategory(path,label){
  const c = document.getElementById("content");
  c.innerHTML="";
  const files = await fetchDir(path);
  const pdfs = files.filter(f=>f.type==="file" && /\.pdf$/i.test(f.name));

  const panel=document.createElement("div");
  panel.className="panel";
  panel.innerHTML=`<h2>${label}</h2>`;

  pdfs.forEach(pdf=>{
    const base = pdf.name.replace(/\.pdf$/i,"").toLowerCase();
    const img = files.find(f=>f.type==="file" && IMG_RE.test(f.name) && f.name.replace(IMG_RE,"").toLowerCase()===base);
    const it=document.createElement("div");
    it.className="item";
    const b=document.createElement("button");
    b.textContent=smartTitle(pdf.name);
    b.onclick=()=>renderArticle(pdf,img);
    it.appendChild(b);
    if(img){
      const im=document.createElement("img");
      im.src=img.download_url;
      im.className="thumb";
      it.appendChild(im);
    }
    panel.appendChild(it);
  });

  c.appendChild(panel);
}

async function init(){
  const root = await fetchDir();
  const dirs = root.filter(x=>x.type==="dir");
  const tabs=document.getElementById("tabs");

  dirs.forEach(d=>{
    const b=document.createElement("button");
    b.textContent=smartTitle(d.name.replace(/:$/,""));
    b.onclick=()=>{
      document.querySelectorAll("nav button").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      renderCategory(d.path, smartTitle(d.name.replace(/:$/,"")));
    };
    tabs.appendChild(b);
  });

  if(tabs.firstChild) tabs.firstChild.click();
}

init();
</script>

</body>
</html>
