<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Didactic Eureka</title>

<style>
:root{
  --bg:#f6f5f2; --paper:#ffffff; --ink:#141414; --muted:#5c5c5c;
  --line:#e3e1da;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family: ui-serif, Georgia, "Times New Roman", serif;
  line-height:1.7;
}
header{
  position:sticky; top:0; z-index:10;
  background:var(--paper);
  border-bottom:1px solid var(--line);
}
.wrap{max-width:1100px;margin:auto;padding:0 22px}
.top{
  display:flex;justify-content:space-between;align-items:center;
  padding:18px 0;
}
h1{margin:0;font-size:22px}
nav{display:flex;gap:8px;flex-wrap:wrap}
nav a{
  text-decoration:none;color:var(--ink);
  font-size:13px;padding:6px 10px;border-radius:20px;
}
nav a:hover{background:#eee}
main{padding:28px 0}
section{
  background:var(--paper);
  border:1px solid var(--line);
  border-radius:16px;
  padding:18px;
  margin-bottom:24px;
}
section h2{margin:0 0 14px}
.item{margin-bottom:14px}
.item button{
  background:none;border:none;
  font-family:inherit;
  font-size:15px;
  cursor:pointer;
  color:#000;
}
.item button:hover{text-decoration:underline}
iframe,img{
  width:100%;
  margin-top:12px;
  border-radius:12px;
  border:1px solid var(--line);
}
iframe{height:70vh}
footer{
  border-top:1px solid var(--line);
  padding:20px;
  font-size:12px;
  color:var(--muted);
  text-align:center;
}
</style>
</head>

<body>

<header>
  <div class="wrap top">
    <h1>Didactic Eureka</h1>
    <nav id="menu"></nav>
  </div>
</header>

<main class="wrap" id="content">
  <p>Cargando estructura…</p>
</main>

<footer>
  Lectura directa · estructura viva · carpeta madre como fuente de verdad
</footer>

<script>
const owner = location.hostname.split(".")[0];
const repo  = location.pathname.split("/").filter(Boolean)[0];
const api = `https://api.github.com/repos/${owner}/${repo}/contents`;

function titleCase(str){
  return str
    .replace(/[-_]+/g," ")
    .replace(/:/g,"")
    .toLowerCase()
    .split(" ")
    .map(w=>w?w[0].toUpperCase()+w.slice(1):"")
    .join(" ");
}

async function fetchDir(path=""){
  const r = await fetch(path ? `${api}/${encodeURIComponent(path)}` : api);
  if(!r.ok) return [];
  return await r.json();
}

async function collectFiles(path){
  const out=[];
  const stack=[path];
  while(stack.length){
    const p=stack.pop();
    const items=await fetchDir(p);
    for(const it of items){
      if(it.type==="dir") stack.push(it.path);
      if(it.type==="file" && /\.(pdf|png|jpg|jpeg|webp)$/i.test(it.name)){
        out.push(it);
      }
    }
  }
  return out;
}

function openItem(it,container){
  container.innerHTML="";
  const h=document.createElement("h3");
  h.textContent=titleCase(it.name.replace(/\.(pdf|png|jpg|jpeg|webp)$/i,""));
  container.appendChild(h);
  if(it.name.toLowerCase().endsWith(".pdf")){
    const f=document.createElement("iframe");
    f.src=it.download_url+"#toolbar=0";
    container.appendChild(f);
  }else{
    const i=document.createElement("img");
    i.src=it.download_url;
    container.appendChild(i);
  }
}

(async()=>{
  const root = await fetchDir();
  const menu = document.getElementById("menu");
  const content = document.getElementById("content");
  content.innerHTML="";
  menu.innerHTML="";

  for(const dir of root.filter(x=>x.type==="dir")){
    const section=document.createElement("section");
    section.id=dir.name;
    const h2=document.createElement("h2");
    h2.textContent=titleCase(dir.name);
    section.appendChild(h2);

    const files = await collectFiles(dir.name);
    for(const f of files){
      const div=document.createElement("div");
      div.className="item";
      const btn=document.createElement("button");
      btn.textContent=titleCase(f.name.replace(/\.(pdf|png|jpg|jpeg|webp)$/i,""));
      btn.onclick=()=>openItem(f,div);
      div.appendChild(btn);
      section.appendChild(div);
    }

    content.appendChild(section);

    const a=document.createElement("a");
    a.href="#"+dir.name;
    a.textContent=titleCase(dir.name);
    menu.appendChild(a);
  }
})();
</script>

</body>
</html>
