<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Didactic Eureka</title>

<style>
:root{
  --bg:#f6f5f2;
  --paper:#ffffff;
  --ink:#141414;
  --muted:#666;
  --line:#e2e0d9;
  --accent:#1f3cff;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family: ui-serif, Georgia, "Times New Roman", serif;
  line-height:1.7;
}
.wrap{max-width:1200px;margin:auto;padding:0 22px}
header{
  position:sticky;top:0;z-index:10;
  background:var(--paper);
  border-bottom:1px solid var(--line);
}
.top{
  display:flex;justify-content:space-between;align-items:center;
  padding:16px 0;
}
h1{margin:0;font-size:22px}
nav{display:flex;gap:8px;flex-wrap:wrap}
nav button{
  background:none;border:none;
  font-family:inherit;
  font-size:13px;
  padding:6px 12px;
  border-radius:999px;
  cursor:pointer;
}
nav button.active,
nav button:hover{background:#efefe9}
main{padding:24px 0 48px}
.panel{
  background:var(--paper);
  border:1px solid var(--line);
  border-radius:16px;
  padding:18px;
  margin-bottom:20px;
}
.panel h2{margin:0 0 12px;font-size:20px}
.item{
  padding:10px 0;
  border-top:1px solid var(--line);
}
.item:first-child{border-top:none}
.item a{
  text-decoration:none;
  color:var(--accent);
  font-weight:600;
}
.item a:hover{text-decoration:underline}
.thumb{
  max-width:420px;
  width:100%;
  border-radius:12px;
  border:1px solid var(--line);
  margin:10px 0;
}
footer{
  border-top:1px solid var(--line);
  padding:18px 0;
  font-size:12px;
  color:var(--muted);
  text-align:center;
}
</style>
</head>

<body>

<header>
  <div class="wrap top">
    <h1>Didactic Eureka</h1>
    <nav id="tabs"></nav>
  </div>
</header>

<main class="wrap" id="content">
  <p>Cargando contenido…</p>
</main>

<footer>
  Didactic Eureka · estructura autónoma · lectura editorial
</footer>

<script>
const owner = location.hostname.split(".")[0];
const repo  = location.pathname.split("/").filter(Boolean)[0];
const API   = `https://api.github.com/repos/${owner}/${repo}/contents`;
const IMG_RE = /\.(jpg|jpeg|png|webp)$/i;

function titleFromFilename(name){
  return name
    .replace(/\.(pdf)$/i,"")
    .replace(/[_\-]+/g," ")
    .replace(/\s+/g," ")
    .toLowerCase()
    .split(" ")
    .map(w=>w?w[0].toUpperCase()+w.slice(1):"")
    .join(" ");
}

async function fetchDir(path=""){
  const r = await fetch(path?`${API}/${encodeURIComponent(path)}`:API);
  if(!r.ok) return [];
  return await r.json();
}

async function build(){
  const root = await fetchDir();
  const dirs = root.filter(x=>x.type==="dir");

  const tabs = document.getElementById("tabs");
  const content = document.getElementById("content");
  tabs.innerHTML="";
  content.innerHTML="";

  async function renderDir(dir, path){
    const files = await fetchDir(path);
    const pdfs = files.filter(x=>x.type==="file" && /\.pdf$/i.test(x.name));
    if(!pdfs.length) return;

    const panel = document.createElement("div");
    panel.className="panel";
    panel.innerHTML=`<h2>${titleFromFilename(dir)}</h2>`;

    for(const pdf of pdfs){
      const base = pdf.name.replace(/\.pdf$/i,"").toLowerCase();
      const img = files.find(f=>f.type==="file" && IMG_RE.test(f.name) && f.name.replace(IMG_RE,"").toLowerCase()===base);

      const item = document.createElement("div");
      item.className="item";
      item.innerHTML = `
        <a href="${pdf.download_url}" target="_blank">${titleFromFilename(pdf.name)}</a>
        ${img ? `<img class="thumb" src="${img.download_url}">` : ``}
      `;
      panel.appendChild(item);
    }
    content.appendChild(panel);
  }

  for(const d of dirs){
    const btn = document.createElement("button");
    btn.textContent = titleFromFilename(d.name);
    btn.onclick = async ()=>{
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      content.innerHTML="";
      await renderDir(d.name, d.path);
    };
    tabs.appendChild(btn);
  }

  if(tabs.firstChild){
    tabs.firstChild.click();
  }
}

build().catch(()=>{
  document.getElementById("content").innerHTML="<p>Error leyendo el repositorio.</p>";
});
</script>

</body>
</html>
