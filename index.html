<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Didactic Eureka</title>
  <meta name="description" content="Didactic Eureka · GitHub Pages · PDFs vivos" />
  <style>
    body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#0e1117;color:#e6e6e6;line-height:1.6}
    header,main,footer{max-width:1050px;margin:auto;padding:3rem 2rem}
    h1{font-size:2.4rem;margin:0 0 .75rem}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-top:1.25rem}
    a.card{display:block;padding:1.1rem;border:1px solid #2a2f3a;border-radius:14px;background:#141821;color:inherit;text-decoration:none}
    a.card:hover{border-color:#6b87ff}
    section{margin-top:2.5rem}
    details{border:1px solid #2a2f3a;border-radius:14px;background:#121620;padding:1rem;margin:.75rem 0}
    summary{cursor:pointer;font-weight:650}
    ul{margin:.75rem 0 0 1.2rem}
    li{margin:.4rem 0}
    a.pdf{color:#9fb4ff;text-decoration:none}
    a.pdf:hover{text-decoration:underline}
    .muted{color:#a7a7a7}
    .err{color:#ffb4b4}
    footer{border-top:1px solid #2a2f3a;color:#a7a7a7;font-size:.9rem}
    code{color:#c6d0ff}
  </style>
</head>
<body>
<header>
  <h1>Didactic Eureka</h1>
  <p class="muted">GitHub Pages · navegación modular (Referencia 1) · listado automático de PDFs</p>

  <div class="grid">
    <a class="card" href="#biblioteca"><strong>Biblioteca</strong><br>PDFs por carpeta</a>
    <a class="card" href="#estado"><strong>Estado</strong><br>verificación técnica</a>
  </div>
</header>

<main>
  <section id="biblioteca">
    <h2>Biblioteca (PDFs)</h2>
    <p class="muted">Se listan desde GitHub vía API, recursivamente.</p>

    <div id="sections"></div>
    <p id="msg" class="muted"></p>
  </section>

  <section id="estado">
    <h2>Estado</h2>
    <p class="muted">
      Detectado: <code id="who"></code><br/>
      Si esto queda vacío o da error, el repo puede estar privado o GitHub limitó la API.
    </p>
    <p id="err" class="err"></p>
  </section>
</main>

<footer>
  Didactic Eureka · Padre (GitHub) · listado recursivo de PDFs
</footer>

<script>
  // Auto-detección robusta para GitHub Pages:
  // owner = subdominio (tomaslavadossepulveda.github.io)
  // repo  = primer segmento del path (/didactic-eureka/...)
  const owner = (location.hostname || "").split(".")[0] || "";
  const repo  = (location.pathname.split("/").filter(Boolean)[0]) || "";
  document.getElementById("who").textContent = owner && repo ? `${owner}/${repo}` : "(no detectado)";

  // Tus carpetas reales (del ZIP): terminan en ":" y algunas tienen unicode raro.
  // Aquí pongo los paths EXACTOS esperables en GitHub (tal como están en el repo).
  // Si alguna no existe, se ignora sin romper.
  const CATEGORIES = [
    { label: "Filosofía",    path: "filosofia:" },
    { label: "Teología",     path: "teologia:" },
    { label: "Ciencia",      path: "ciencia:" },
    { label: "Arte (si existe)", path: "arte:" },        // por si luego la creas
    { label: "Ensayos",      path: "ensayos:" },
    { label: "Teorética",    path: "teoretica:" },
    { label: "Lingüística",  path: "linguistica:" },
    { label: "Antropología", path: "antropologia:" },
    { label: "Derecho",      path: "derecho:" },
    { label: "Yoga",         path: "yoga:" },
    // Esta carpeta en tu ZIP tiene nombre raro; la API la reconoce igual si existe.
    { label: "Psicología",   path: "psicologi╠üa:" }
  ];

  const apiBase = () => `https://api.github.com/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/contents`;

  async function fetchContents(dirPath) {
    const url = `${apiBase()}/${encodeURIComponent(dirPath)}`;
    const res = await fetch(url, { headers: { "Accept": "application/vnd.github+json" } });
    if (!res.ok) throw new Error(`API ${res.status} en ${dirPath}`);
    return await res.json();
  }

  async function listPdfsRecursive(startPath) {
    const out = [];
    const stack = [startPath];

    while (stack.length) {
      const p = stack.pop();
      let items;
      try {
        items = await fetchContents(p);
      } catch (e) {
        // si la carpeta no existe o falla, salimos limpio
        return { ok:false, pdfs:[], error:String(e) };
      }

      // Si es archivo (no dir), normalizamos a lista vacía
      if (!Array.isArray(items)) continue;

      for (const it of items) {
        if (it.type === "dir") {
          stack.push(it.path);
        } else if (it.type === "file" && (it.name || "").toLowerCase().endsWith(".pdf")) {
          out.push({ name: it.name, url: it.download_url });
        }
      }
    }

    // orden alfabético
    out.sort((a,b) => a.name.localeCompare(b.name, "es"));
    return { ok:true, pdfs:out, error:null };
  }

  function makeSection(title, pdfs) {
    const d = document.createElement("details");
    d.open = false;
    const s = document.createElement("summary");
    s.textContent = `${title} · ${pdfs.length} PDF`;
    d.appendChild(s);

    const ul = document.createElement("ul");
    for (const f of pdfs) {
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.className = "pdf";
      a.href = f.url;
      a.target = "_blank";
      a.rel = "noopener";
      a.textContent = f.name;
      li.appendChild(a);
      ul.appendChild(li);
    }
    d.appendChild(ul);
    return d;
  }

  async function boot() {
    const msg = document.getElementById("msg");
    const err = document.getElementById("err");
    const host = document.getElementById("sections");

    if (!owner || !repo) {
      err.textContent = "No pude detectar owner/repo desde la URL. Abre esto desde GitHub Pages (github.io).";
      return;
    }

    msg.textContent = "Cargando PDFs desde GitHub…";

    let total = 0;
    for (const c of CATEGORIES) {
      const r = await listPdfsRecursive(c.path);
      if (r.ok && r.pdfs.length) {
        host.appendChild(makeSection(c.label, r.pdfs));
        total += r.pdfs.length;
      }
    }

    msg.textContent = total
      ? `Listo: ${total} PDFs detectados.`
      : "No se detectaron PDFs en las carpetas listadas (o el repo es privado / API limitada).";
  }

  boot().catch(e => {
    document.getElementById("err").textContent = String(e);
  });
</script>
</body>
</html>
