<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Didactic Eureka</title>

<style>
body {
  margin: 0;
  font-family: Georgia, "Times New Roman", serif;
  background: #f6f5f2;
  color: #141414;
}
header {
  background: #ffffff;
  border-bottom: 1px solid #ddd;
  padding: 14px;
  position: sticky;
  top: 0;
  z-index: 10;
}
h1 {
  margin: 0 0 10px 0;
  font-size: 22px;
}
nav {
  display: flex;
  gap: 8px;
  overflow-x: auto;
}
nav button {
  border: none;
  background: #eee;
  padding: 6px 14px;
  border-radius: 20px;
  cursor: pointer;
  white-space: nowrap;
}
nav button.active {
  background: #ccc;
}
main {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}
.section-title {
  font-size: 20px;
  margin-bottom: 12px;
}
.item {
  padding: 10px 0;
  border-bottom: 1px solid #ddd;
}
.item button {
  background: none;
  border: none;
  color: #1f3cff;
  cursor: pointer;
  font-size: 16px;
  text-align: left;
}
.item button:hover {
  text-decoration: underline;
}
.article img {
  max-width: 100%;
  margin-bottom: 16px;
}
.article iframe {
  width: 100%;
  height: 80vh;
  border: none;
}
</style>
</head>

<body>

<header>
  <h1>Didactic Eureka</h1>
  <nav id="nav"></nav>
</header>

<main id="content">
  <p>Cargando…</p>
</main>

<script>
/* Función que transforma nombres de archivo en títulos legibles */
function humanTitle(str) {
  return str
    .replace(/\.pdf$/i, "")
    .replace(/[_\-]+/g, " ")
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")  // elimina acentos
    .trim()
    .toLowerCase()
    .split(" ")
    .map(w => w ? w[0].toUpperCase() + w.slice(1) : "")
    .join(" ");
}

// Construye la URL absoluta base para recursos del mismo repo
const BASE = location.origin + location.pathname.replace(/\/[^\/]*$/, "");

// Muestra un artículo (PDF) dentro del sitio
function showArticle(cat, file) {
  const content = document.getElementById("content");
  const pdfUrl = `${BASE}/${encodeURIComponent(cat)}/${encodeURIComponent(file)}`;
  const imgUrl = pdfUrl.replace(/\.pdf$/i, ".jpg");

  content.innerHTML = `
    <div class="article">
      <h2>${humanTitle(file)}</h2>
      <img src="${imgUrl}" onerror="this.style.display='none'">
      <iframe src="${pdfUrl}" loading="lazy"></iframe>
    </div>
  `;
}

// Carga y despliega el contenido (categorías y artículos) desde manifest.json
fetch("manifest.json")
  .then(res => res.json())
  .then(manifest => {
    const nav = document.getElementById("nav");
    const content = document.getElementById("content");
    nav.innerHTML = "";
    content.innerHTML = "";

    // Crea pestañas para cada carpeta
    Object.entries(manifest.folders || {}).forEach(([catName, catData], idx) => {
      const btn = document.createElement("button");
      btn.textContent = humanTitle(catName);
      btn.onclick = () => {
        document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        // Mostrar lista de artículos
        content.innerHTML = `<h2 class="section-title">${humanTitle(catName)}</h2>`;
        if (!catData.files || catData.files.length === 0) {
          content.innerHTML += "<p>No hay artículos.</p>";
        } else {
          catData.files.forEach(file => {
            const div = document.createElement("div");
            div.className = "item";
            div.innerHTML = `<button onclick="showArticle('${catName}', '${file}')">${humanTitle(file)}</button>`;
            content.appendChild(div);
          });
        }
      };
      nav.appendChild(btn);

      // Abre la primera pestaña automáticamente
      if (idx === 0) btn.click();
    });
  })
  .catch(() => {
    document.getElementById("content").innerHTML = "<p>Error al cargar el contenido.</p>";
  });
</script>

</body>
</html>

