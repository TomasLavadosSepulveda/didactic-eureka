<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Didactic Eureka</title>

<style>
body{
  margin:0;
  font-family: Georgia, "Times New Roman", serif;
  background:#f6f5f2;
  color:#141414;
}
header{
  position: sticky;
  top: 0;
  z-index: 10;
  background:#ffffff;
  border-bottom:1px solid #ddd;
  padding:14px;
}
h1{margin:0 0 10px 0;font-size:22px}
nav{
  display:flex;
  gap:8px;
  overflow-x:auto;
}
nav button{
  border:none;
  background:#eee;
  padding:6px 14px;
  border-radius:20px;
  cursor:pointer;
  white-space:nowrap;
}
nav button.active{background:#ccc}
main{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.section-title{font-size:20px;margin-bottom:12px}
.item{
  padding:10px 0;
  border-bottom:1px solid #ddd;
}
.item button{
  background:none;
  border:none;
  color:#1f3cff;
  cursor:pointer;
  font-size:16px;
  text-align:left;
}
.item button:hover{text-decoration:underline}
.article img{
  max-width:100%;
  margin-bottom:16px;
}
.article iframe{
  width:100%;
  height:80vh;
  border:none;
}
</style>
</head>

<body>

<header>
  <h1>Didactic Eureka</h1>
  <nav id="nav"></nav>
</header>

<main id="content">
  <img src="main.jpg" style="max-width:100%;margin-bottom:20px"
       onerror="this.style.display='none'">
  <p>Cargando…</p>
</main>

<script>
// --- UTILIDADES ---
function normalize(str){
  return str
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"") // quita acentos
    .replace(/\.pdf$/i,"")
    .replace(/[_\-]+/g," ")
    .replace(/\s+/g," ")
    .toLowerCase()
    .replace(/\b\w/g,l=>l.toUpperCase());
}

// Base absoluta del sitio (evita errores de ruta)
const BASE = location.origin + location.pathname.replace(/\/[^\/]*$/,"");

// --- RENDER ARTÍCULO ---
function openArticle(cat, file){
  const content = document.getElementById("content");
  const title = normalize(file);
  const pdfUrl = `${BASE}/${encodeURI(cat)}/${encodeURI(file)}`;
  const imgUrl = pdfUrl.replace(/\.pdf$/i,".jpg");

  content.innerHTML = `
    <div class="article">
      <h2>${title}</h2>
      <img src="${imgUrl}" onerror="this.style.display='none'">
      <iframe src="${pdfUrl}" loading="lazy"></iframe>
    </div>
  `;
}

// --- CARGA DEL MANIFEST ---
fetch("manifest.json", {cache:"no-store"})
.then(r => r.json())
.then(manifest => {
  const nav = document.getElementById("nav");
  const content = document.getElementById("content");

  function showCategory(name, data){
    content.innerHTML = `<h2 class="section-title">${normalize(name)}</h2>`;
    if(!data.files || data.files.length === 0){
      content.innerHTML += "<p>No hay artículos.</p>";
      return;
    }
    data.files.forEach(file => {
      const div = document.createElement("div");
      div.className = "item";
      const btn = document.createElement("button");
      btn.textContent = normalize(file);
      btn.onclick = () => openArticle(name, file);
      div.appendChild(btn);
      content.appendChild(div);
    });
  }

  const entries = Object.entries(manifest.folders || {});
  nav.innerHTML = "";

  entries.forEach(([name, data], i) => {
    const btn = document.createElement("button");
    btn.textContent = normalize(name);
    btn.onclick = () => {
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      showCategory(name, data);
    };
    nav.appendChild(btn);
    if(i === 0) btn.click();
  });
})
.catch(err => {
  document.getElementById("content").innerHTML =
    "<p>Error al cargar el contenido.</p>";
  console.error(err);
});
</script>

</body>
</html>

