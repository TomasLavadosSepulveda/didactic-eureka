<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Didactic Eureka</title>

<style>
body{
  margin:0;
  font-family: Georgia, "Times New Roman", serif;
  background:#f6f5f2;
  color:#141414;
}
header{
  position: sticky;
  top: 0;
  z-index: 10;
  background:#ffffff;
  border-bottom:1px solid #ddd;
  padding:14px;
}
h1{
  margin:0 0 10px 0;
  font-size:22px;
}
nav{
  display:flex;
  gap:8px;
  overflow-x:auto;
}
nav button{
  border:none;
  background:#eee;
  padding:6px 14px;
  border-radius:20px;
  cursor:pointer;
  white-space:nowrap;
}
nav button.active{
  background:#ccc;
}
main{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.section-title{
  font-size:20px;
  margin-bottom:12px;
}
.item{
  padding:10px 0;
  border-bottom:1px solid #ddd;
}
.item button{
  background:none;
  border:none;
  color:#1f3cff;
  cursor:pointer;
  font-size:16px;
  text-align:left;
}
.item button:hover{
  text-decoration:underline;
}
.article img{
  max-width:100%;
  margin-bottom:16px;
}
.article iframe{
  width:100%;
  height:80vh;
  border:none;
}
</style>
</head>

<body>

<header>
  <h1>Didactic Eureka</h1>
  <nav id="nav"></nav>
</header>

<main id="content">
  <img src="main.jpg" style="max-width:100%;margin-bottom:20px"
       onerror="this.style.display='none'">
  <p>Cargando…</p>
</main>

<script>
function titleize(name){
  return name
    .replace(/\.pdf$/i,"")
    .replace(/[_\-]+/g," ")
    .toLowerCase()
    .replace(/\b\w/g,l=>l.toUpperCase());
}

function openArticle(path, title){
  const content = document.getElementById("content");
  const imgPath = path.replace(/\.pdf$/i,".jpg");

  content.innerHTML = `
    <div class="article">
      <h2>${title}</h2>
      <img src="${imgPath}" onerror="this.style.display='none'">
      <iframe src="${path}" loading="lazy"></iframe>
    </div>
  `;
}

fetch("manifest.json")
.then(r => r.json())
.then(manifest => {
  const nav = document.getElementById("nav");
  const content = document.getElementById("content");

  function showCategory(catName, catData){
    content.innerHTML = `<h2 class="section-title">${titleize(catName)}</h2>`;
    if(catData.files.length === 0){
      content.innerHTML += "<p>No hay artículos.</p>";
    }
    catData.files.forEach(file => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <button onclick="openArticle('${catName}/${file}','${titleize(file)}')">
          ${titleize(file)}
        </button>
      `;
      content.appendChild(div);
    });
  }

  const entries = Object.entries(manifest.folders);

  entries.forEach(([name, data], i) => {
    const btn = document.createElement("button");
    btn.textContent = titleize(name);
    btn.onclick = () => {
      document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      showCategory(name, data);
    };
    nav.appendChild(btn);
    if(i === 0) btn.click();
  });

})
.catch(() => {
  document.getElementById("content").innerHTML =
    "<p>Error al cargar el contenido.</p>";
});
</script>

</body>
</html>
